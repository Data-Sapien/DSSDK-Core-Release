<!DOCTYPE html>
<html>
<head>
  <meta charset='UTF-8' />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  <title>MeDataView</title>
      <style>
        html, body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          margin: 0;
          padding: 16px;
          background: #F2F3F4;
          font-size: 16px;
          overflow-x: hidden; /* ✅ Disable horizontal scroll */
          max-width: 100vw;   /* ✅ Clamp to viewport width */
        }

        .loader {
          text-align: center;
          margin-top: 2rem;
          font-size: 1.4rem;
          color: #666;
        }

        .error {
          color: red;
          text-align: center;
          padding: 1.5rem;
          font-size: 1.4rem;
        }

        .section {
          margin-bottom: 2rem;
        }

        .section-header {
          font-size: 1rem;
          font-weight: 700;
          color: #7A7A7A;
          margin: 2rem 0 1.2rem;
          text-transform: uppercase;
          padding-left: 0.2rem;
        }

        .row {
          display: flex;
          align-items: flex-start;
          background: white;
          border-radius: 14px;
          padding: 1rem 1.2rem;
          margin-bottom: 1rem;
          box-shadow: 0 1px 2px rgba(0,0,0,0.05);
          flex-wrap: wrap; /* ✅ If content overflows, wrap to next line */
        }

        .icon {
          width: 24px;
          height: 24px;
          margin-right: 12px;
          object-fit: contain;
          border-radius: 6px;
          flex-shrink: 0;
        }

        .text-block {
          display: flex;
          flex-direction: column;
          flex: 1;
          min-width: 0; /* ✅ Prevent overflow in flex containers */
        }

        .label {
          font-size: 1rem;
          font-weight: 600;
          color: #111;
          margin-bottom: 0.2rem;
        }

        .value {
          font-size: 0.95rem;
          color: #3A3A3A;
          line-height: 1.5;
          white-space: pre-wrap;
          word-break: break-word;
        }

        .value.empty {
          color: #999;
          font-style: italic;
        }
      </style>
</head>
<body>
  <div id='content'></div>
  <script>
    var content = document.getElementById('content');
    function renderLoading() { content.innerHTML = '<div class="loader">Loading MeData...</div>'; }
    function renderError(message) { content.innerHTML = '<div class="error">⚠️ ' + message + '</div>'; }
    function renderGroups(groups) {
      content.innerHTML = '';

      // Sort by category name (case-insensitive)
      groups.sort(function(a, b) {
        return a.category.name.localeCompare(b.category.name, undefined, { sensitivity: 'base' });
      });

      for (var i = 0; i < groups.length; i++) {
        var categoryGroup = groups[i];
        var section = document.createElement('div');
        section.className = 'section';

        var header = document.createElement('div');
        header.className = 'section-header';
        header.innerText = categoryGroup.category.name;
        section.appendChild(header);

        for (var j = 0; j < categoryGroup.groups.length; j++) {
          var group = categoryGroup.groups[j];
          var row = document.createElement('div');
          row.className = 'row';

          if (group.meDataDefinition && group.meDataDefinition.iconFullURL) {
            var img = document.createElement('img');
            img.className = 'icon';
            img.src = group.meDataDefinition.iconFullURL;
            row.appendChild(img);
          }

          var textBlock = document.createElement('div');
          textBlock.className = 'text-block';

          var label = document.createElement('div');
          label.className = 'label';
          label.innerText = group.meDataDefinition.text || group.meDataDefinition.name;

          var values = [];
          if (group.meData && group.meData.meDataValueInfo && group.meData.lastValueId) {
            for (var m = 0; m < group.meData.meDataValueInfo.length; m++) {
              var info = group.meData.meDataValueInfo[m];
              if (info.id === group.meData.lastValueId) {
                values = info.meDataValue || [];
                break;
              }
            }
          }

          var last = '';
          for (var k = 0; k < values.length; k++) {
            var val = values[k].value;
            if (val && val.trim() !== '') {
              if (last.length > 0) last += '\n';
              last += val.trim();
            }
          }

          var value = document.createElement('div');
          value.className = 'value' + (last ? '' : ' empty');
          value.innerText = last || 'No data available';

          textBlock.appendChild(label);
          textBlock.appendChild(value);
          row.appendChild(textBlock);
          section.appendChild(row);
        }

        content.appendChild(section);
      }
    }
    function loadMeDataGroups() {
      renderLoading();
      if (!window.MeDataService || !window.MeDataService.getMeDataCategoryGroups) {
        renderError('MeDataService is not available.'); return;
      }
      window.MeDataService.getMeDataCategoryGroups(function(result) {
        if (result.error) { renderError(result.error); }
        else { renderGroups(result); }
      });
    }
    loadMeDataGroups();
  </script>
</body>
</html>
